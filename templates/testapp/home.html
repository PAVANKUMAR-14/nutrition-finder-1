<!DOCTYPE html>
{% load static %}
{% load mathfilters %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'img/favicon1.png' %}">
    <title>Nutrition checker</title>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="row-1 text-center">
            <div class="offset-sm-4 col-sm-4 offset-sm-4">
                <img src="{% static 'img/foodie.png' %}" alt="foodie" class="img-fluid">
            </div>
        </div>

        <!-- Search Form -->
        <div class="row-2 mt-5">
            <div class="offset-md-2 col-md-8 offset-md-2 col-sm-12">
                <form action="" method="POST">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="text" name="search" placeholder="Type food name correctly" required 
                               class="form-control my-search-form">
                        <button type="submit" class="btn btn-success my-search-button">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </div>
                </form>

                <!-- API Response Handling -->
                {% if api %}
                    {% if api == "oohhh ! something went wrong, try again" %}
                        <div class="alert alert-danger text-center mt-1" role="alert">
                            <strong>Oops something went wrong! Try again later</strong>
                        </div>
                    {% else %}
                        <!-- Food Information -->
                        <div class="text-center mt-4">
                            <h3 class="food-title">
                                {{ api.0.name|capfirst }} contains
                                <span class="text-danger">{{ api.0.cholesterol_mg }}mg</span> cholesterol
                            </h3>
                        </div>

                        <!-- Nutritional Warnings -->
                        {% if api.0.sugar_g > 25 %}
                        <div class="alert alert-danger text-center mt-2" role="alert">
                            <strong>High Sugar Content!</strong> ({{ api.0.sugar_g }}g per 100g)
                        </div>
                        {% endif %}

                        {% if api.0.sodium_mg > 650 %}
                        <div class="alert alert-danger text-center mt-2" role="alert">
                            <strong>High Sodium Content!</strong> ({{ api.0.sodium_mg }}mg per 100g)
                        </div>
                        {% endif %}
                    {% endif %}
                {% endif %}
            </div>
        </div>

        <!-- Nutrition & Exercise Section -->
        {% if api and api != "oohhh ! something went wrong, try again" %}
        <div class="container mt-3" style="background-color:#f6fbf4;">
            <div class="row">
                <!-- Nutrition Table -->
                <div class="col-md-4 col-sm-12">
                    <div class="mt-4 mb-2">
                        <h5 class="text-center">Nutritional Values (per 100g)</h5>
                    </div>
                    <table class="table table-hover">
                        <tbody>
                            <tr><td>Carbohydrates</td><td>{{ api.0.carbohydrates_total_g }}g</td></tr>
                            <tr><td>Total Fat</td><td>{{ api.0.fat_total_g }}g</td></tr>
                            <tr><td>Saturated Fat</td><td>{{ api.0.fat_saturated_g }}g</td></tr>
                            <tr><td>Cholesterol</td><td>{{ api.0.cholesterol_mg }}mg</td></tr>
                            <tr><td>Fiber</td><td>{{ api.0.fiber_g }}g</td></tr>
                            <tr><td>Sodium</td><td>{{ api.0.sodium_mg }}mg</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Exercise Recommendations -->
                <div class="col-md-8 col-sm-12">
                    <div class="mt-4">
                        <h2 class="mb-4">Fitness Recommendations</h2>
                        {% with energy=api.0.carbohydrates_total_g|mul:4|add:api.0.fat_total_g|mul:9 %}
                        {% with total_score=energy|add:api.0.cholesterol_mg %}
                        
                        <div class="alert alert-warning">
                            Energy Estimate: {{ energy }} points 
                            (Carbs: {{ api.0.carbohydrates_total_g }}g × 4 + Fat: {{ api.0.fat_total_g }}g × 9)
                        </div>

                        <div class="alert alert-info">
                            Total Fitness Score: {{ total_score }} 
                            (Energy + Cholesterol: {{ api.0.cholesterol_mg }}mg)
                        </div>

                        <div class="exercise-group">
                            <div class="exercise-item">
                                <img src="{% static 'img/runner.png' %}" class="exercise-icon">
                                <div>
                                    <h5>Jogging</h5>
                                    <p>{{ total_score|div:200|mul:60|floatformat:0 }} minutes</p>
                                </div>
                            </div>

                            <div class="exercise-item">
                                <img src="{% static 'img/yoga-pose.png' %}" class="exercise-icon">
                                <div>
                                    <h5>Yoga</h5>
                                    <p>{{ total_score|div:180|mul:60|floatformat:0 }} minutes</p>
                                </div>
                            </div>

                            <div class="exercise-item">
                                <img src="{% static 'img/weightlifter.png' %}" class="exercise-icon">
                                <div>
                                    <h5>Weight Training</h5>
                                    <p>{{ total_score|div:400|mul:60|floatformat:0 }} minutes</p>
                                </div>
                            </div>

                            <div class="exercise-item">
                                <img src="{% static 'img/walking-man.png' %}" class="exercise-icon">
                                <div>
                                    <h5>Walking</h5>
                                    <p>{{ total_score|div:150|mul:60|floatformat:0 }} minutes</p>
                                </div>
                            </div>
                        </div>
                        {% endwith %}{% endwith %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Footer -->
        <div class="row mt-5">
            <div class="col-12 text-center">
                <h6 class="designer-credit">
                    Crafted and Designed by Pavan Kumar
                </h6>
            </div>
        </div>
    </div>
</body>
</html>
